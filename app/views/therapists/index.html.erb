
<div class="search-page">
  <div class="filters stick-to-nav d-flex flex-column">
    <div class="filter-language">
      <%= form_tag therapists_path, method: :get do %>
      <% languages = [] %>
      <%  Therapist.all.each do |therapist| %>
          <% languages << therapist.language %>
          <% languages = languages.uniq %>
      <% end %>
      <%= label_tag 'language', 'Language spoken:' %>
      <div class="d-flex">
        <%= select_tag "language", options_for_select(languages.map{|s| ["#{s}", s]}), class: "form-control" %>
        <% if params[:query].present? %>
          <%= hidden_field_tag :query, params[:query] %>
        <% end %>
        <%= submit_tag "Apply filter", class: "button-navy-small ml-2" %>

        </div>
      <% end %>
    </div>

      <div class="filter-rate">
      <%= label_tag 'rate', 'Hourly rate:' %>
      <%= form_tag therapists_path, method: :get do %>
      <div class="d-flex">
      <%= select_tag "rate", options_for_select((20..100).step(5).to_a.map{|s| ["#{s}€/hour", s]}), class: "form-control" %>
      <% if params[:query].present? %>
        <%= hidden_field_tag :query, params[:query] %>
      <% end %>
      <%= submit_tag "Apply filter", class: "button-navy-small ml-2" %>
    </div>
      <% end %>
    </div>

    <div class="filter-exp">
      <%= label_tag 'years_exp', 'Years of experience:' %>
      <%= form_tag therapists_path, method: :get do %>
      <div class="d-flex">
      <%= select_tag "years_exp", options_for_select((1..10).step(1).to_a.map{|s| ["#{s}", s]}), class: "form-control" %>
      <% if params[:query].present? %>
        <%= hidden_field_tag :query, params[:query] %>
      <% end %>
      <%= submit_tag "Apply filter", class: "button-navy-small ml-2" %>
    </div>
      <% end %>
    </div>
    <div class="filter-rating">
      <%= label_tag 'rating', 'Average rating:' %>
      <%= form_tag therapists_path, method: :get do %>
      <div class="d-flex">
      <%= select_tag "rating", options_for_select((3..5).step(0.5).to_a.map{|s| ["#{s} stars or more", s]}), class: "form-control" %>
      <%= submit_tag "Apply filter", class: "button-navy-small ml-2" %>
    </div>
      <% end %>
    </div>
    <div class="filter-specialty">
      <%= label_tag 'specialty', 'Specialty:' %>
      <%= form_tag therapists_path, method: :get do %>
        <div class="d-flex">
        <%= select_tag "specialty", options_from_collection_for_select(@specialties, 'name', 'name'), class: "form-control" %>
        <% if params[:query].present? %>
          <%= hidden_field_tag :query, params[:query] %>
        <% end %>
        <%= submit_tag "Apply filter", class: "button-navy-small ml-2"  %>
      </div>
      <% end %>
    </div>


  </div>
  <div class="search-results pl-3">
    <%= form_tag therapists_path, method: :get do %>
      <% if params[:language].present? %>
    <%= hidden_field_tag :language, params[:language] %>
  <% end %>
  <div class="d-flex">
    <%= text_field_tag :query,
      params[:query],
      class: "form-control my-3 mr-3",
      id: "search-bar",
      placeholder: "Search by specialty or name"
    %>
    <%= submit_tag "Search", id: "search-button", class: "button-navy-md my-3" %>

    </div>
<% end %>

   <% @therapists.each do |therapist| %>
   <%= link_to therapist_path(therapist) do %>
    <div class="therapist-cards">
      <div class="profile-card position-rel">
        <div class="profile-avatar-spacing d-flex flex-column align-items-center mt-3">
        <%= cl_image_tag therapist.photo, class: "avatar-small profile-avatar" %>
         <div class="stars">
<%  %>
    <% full = therapist.avg_rating.round(half: :down)  %>
 <% full.times do %>
    <div class="dark-star">
      <i class="fas fa-star"></i>
    </div>
  <% end %>
    <% if therapist.avg_rating % 1 != 0 %>
     <div class="half-star">
      <i class="fas fa-star-half-alt"></i>
      </div>
    <% end %>
    <% empty = 5 - therapist.avg_rating.round%>
    <% empty.times do %>
    <div class="light-star">
        <i class="far fa-star"></i>
    </div>
    <% end %>
  </div>
</div>

<div class="profile-description">
        <h5 id="name"><%= "#{therapist.first_name} #{therapist.last_name}" %></h5>
          <div class="profile-description-content">
            <h6><strong> <img src="https://cdn1.iconfinder.com/data/icons/random-crafticons/48/misc-_Flag_-512.png" alt=""></strong> <%= therapist.language %></h6>
            <h6><strong>Years of Experience</strong> <%= therapist.years_exp %></h6>
             <div class="specialty-container">
            <% therapist.specialties.each do |specialty|%>
                <div class="specialty-tag">
                  <%= specialty.name %>
                </div>
                <% end %>
            </div>
            <div id="price">
                €<%= therapist.rate %>
           </div>
        </div>
  <% end %>
        </div>

  </div>
</div>
<!-- Therapist.all.collect { |p| [ p.name, p.id ] }
 -->
 <%end %>
